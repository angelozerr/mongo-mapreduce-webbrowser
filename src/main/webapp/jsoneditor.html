<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CodeMirror: JSON Editor Demo</title>
    
	<link rel="stylesheet" type="text/css" href="css/codemirror.css" />
	<link rel="stylesheet" type="text/css" href="css/codemirror-lint.css" />
	
	<script src="scripts/lib/jsonlint/jsonlint.js"></script>
	<script src="scripts/lib/jsonlint/formatter.js"></script>
			
	<script src="scripts/lib/codemirror/codemirror.js"></script>
	<script src="scripts/lib/codemirror/mode/javascript.js"></script>
	<script src="scripts/lib/codemirror/addon/lint/lint.js"></script>
	<script src="scripts/lib/codemirror/addon/lint/json-lint.js"></script>
	<script src="scripts/lib/codemirror/addon/edit/matchbrackets.js"></script>
	<script src="scripts/lib/codemirror/addon/edit/closebrackets.js"></script>
	
    <link rel="stylesheet" href="css/docs.css">

    <style type="text/css">
      .CodeMirror {border: 1px solid black;}
      .activeline {background: #e8f2ff !important;}
      div.CodeMirror span.CodeMirror-matchingbracket{color:black;font-weight:bold;}
    </style>
  </head>
  <body>
    <h1>CodeMirror: JSON Editor</h1>

	<input type="button" value="Format" onclick="javascript:formatJSON();" />
    <textarea id=code>[
 {
 error
  "_id": "post 1",
  "author": "Bob",
  "content": "...",
  "page_views": 5
 },
 {
  "_id": "post 2",
  "author": "Bob",
  "content": "...",
  "page_views": 9
 },
 {
  "_id": "post 3",
  "author": "Bob",
  "content": "...",
  "page_views": 8
 }
]
</textarea>

    <script>

function formatJSON() {
 editor.setValue(formatter.formatJson(editor.getValue(), ' '));
};

window.onload = function() {
  
  // Create CodeMirror Editor with JSON mode
  var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    lineNumbers: true,
    mode: "application/json",
    matchBrackets: true,
    autoCloseBrackets: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-lints"]
  });
  window.editor = editor;
  
  // Highlight current line.
  var hlLine = editor.addLineClass(0, "background", "activeline");
  editor.on("cursorActivity", function() {
	var cur = editor.getLineHandle(editor.getCursor().line);
	if (cur != hlLine) {
	  editor.removeLineClass(hlLine, "background", "activeline");
	  hlLine = editor.addLineClass(cur, "background", "activeline");
	}
  });
  
  // Manage syntax error with JSONLint.
  var validate = function() {
  	CodeMirror.validate(editor, CodeMirror.jsonValidator);  	
  };
  var waiting;
  editor.on("change", function() {
	clearTimeout(waiting);
	waiting = setTimeout(validate, 500);
  });

  setTimeout(validate, 100);
  
};

</script>
<p>This demo runs <a href="https://github.com/zaach/jsonlint">JSONLint</a> over the code
in the editor to validate JSON and display the warnings that JSONLint comes up with.</p>
  </body>
</html>
